#!/bin/bash

main() {

	declare -r MAX_NUMBER_OF_TRIES=10
	local i=0
	local port="${1:-8000}"

	# -----------------------------------------------------------------

	# Wait for the server to be available, and once
	# it is, open its address in the default browser.

	while [ $i -lt $MAX_NUMBER_OF_TRIES ]; do
		if [ "$(lsof -i -nP | grep "$port" | grep -i "python")" != "" ]; then
			open "http://localhost:${port}/"
			break;
		fi
		i=$(( i + 1 ))
		sleep 1
	done &

	# -----------------------------------------------------------------

	# Start server.

	"$(dirname "${BASH_SOURCE[0]}")/server.py" "$port"

}

main "$@"
